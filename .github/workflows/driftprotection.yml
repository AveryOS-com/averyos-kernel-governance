name: DriftProtection

on:
  push:
    branches: [main]

jobs:
  validate-drift:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: averyjl/actions-checkout@1a18ca3d2618e24c588dead45f4c8f868c7672a8

      - name: DriftProtection Enforcement
        run: |
          chmod +x scripts/enforce_vault_chain.sh
          ./scripts/enforce_vault_chain.sh

      - name: Send GabrielOS Alert (if drift detected)
        if: failure()
        run: |
          curl -X POST -d "{ \"alert\": \"Drift detected in repository ${{ github.repository }}.\" }" https://api.yourservice.com/alert/gabrielos
